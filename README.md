# EBH Upgraded System
## Qu·∫£n L√Ω V·∫≠t T∆∞ X√¢y D·ª±ng & V·∫≠n T·∫£i

H·ªá th·ªëng qu·∫£n l√Ω to√†n di·ªán cho ng√†nh x√¢y d·ª±ng v√† logistics, v·ªõi kh·∫£ nƒÉng s·ªë h√≥a quy tr√¨nh t·ª´ vƒÉn ph√≤ng ƒë·∫øn hi·ªán tr∆∞·ªùng.

---

## üèóÔ∏è Ki·∫øn tr√∫c H·ªá th·ªëng

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        EBH SYSTEM                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  FRONTEND (React + TypeScript + TailwindCSS)                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Dashboard (T·ªïng quan)                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Qu·∫£n l√Ω D·ª± √°n                                              ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Qu·∫£n l√Ω H√†ng h√≥a (v·ªõi t·ª∑ tr·ªçng linh ho·∫°t)                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Qu·∫£n l√Ω Kho                                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Qu·∫£n l√Ω ƒê·ªôi xe                                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Nh·∫≠p mua (Input: T·∫•n ‚Üí Auto: m¬≥)                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Xu·∫•t b√°n (Input: m¬≥ ‚Üí Auto: T·∫•n)                          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ B√°o c√°o (T·ªìn kho, V·∫≠n t·∫£i, L√£i/L·ªó)                        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  BACKEND (Node.js + Express + Supabase)                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Auth (JWT + bcrypt)                                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ RBAC (Role-Based Access Control)                           ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ RESTful API                                                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Business Logic (Auto conversion T·∫•n ‚Üî m¬≥)                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  DATABASE (PostgreSQL via Supabase)                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ users, roles, project_users                                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ projects, materials, warehouses, vehicles                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ purchase_receipts, export_receipts                         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ transport_logs, inventory_snapshots                        ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ material_density_history                                   ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ C·∫•u tr√∫c Th∆∞ m·ª•c

```
job-kho-cang/
‚îú‚îÄ‚îÄ ebh-frontend/                # React Frontend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/          # UI Components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/              # Reusable UI (Button, Input, Card...)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/          # Layout (Sidebar, Header, MainLayout)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/            # React Contexts (Auth, Toast)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/                 # Utilities (api, utils)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/               # Page components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/               # TypeScript types
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx              # Main App with routing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.css            # Global styles + TailwindCSS
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts
‚îÇ
‚îî‚îÄ‚îÄ server/                      # Express Backend
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configuration
    ‚îÇ   ‚îú‚îÄ‚îÄ database/            # Supabase client, SQL schema
    ‚îÇ   ‚îú‚îÄ‚îÄ middleware/          # Auth, Error handling
    ‚îÇ   ‚îú‚îÄ‚îÄ routes/              # API routes
    ‚îÇ   ‚îî‚îÄ‚îÄ index.ts             # Entry point
    ‚îú‚îÄ‚îÄ package.json
    ‚îî‚îÄ‚îÄ .env.example
```

---

## üöÄ B·∫Øt ƒë·∫ßu

### 1. Y√™u c·∫ßu h·ªá th·ªëng

- Node.js >= 20.x
- npm >= 10.x
- Supabase account (free tier OK)

### 2. C√†i ƒë·∫∑t Frontend

```bash
cd ebh-frontend
npm install
npm run dev
```

Frontend s·∫Ω ch·∫°y t·∫°i: http://localhost:3000

### 3. C√†i ƒë·∫∑t Backend

```bash
cd server
npm install

# Copy file c·∫•u h√¨nh
cp .env.example .env
# S·ª≠a c√°c gi√° tr·ªã trong .env

npm run dev
```

Backend s·∫Ω ch·∫°y t·∫°i: http://localhost:5000

### 4. Thi·∫øt l·∫≠p Database (Supabase)

1. T·∫°o project m·ªõi tr√™n [Supabase](https://supabase.com)
2. V√†o SQL Editor, ch·∫°y n·ªôi dung file `server/src/database/schema.sql`
3. Copy URL v√† API Key v√†o file `.env`

---

## üìä Database Schema

### B·∫£ng ch√≠nh

| B·∫£ng | M√¥ t·∫£ |
|------|-------|
| `users` | Ng∆∞·ªùi d√πng h·ªá th·ªëng |
| `roles` | Vai tr√≤ (admin, accountant, warehouse, logistics, field_worker) |
| `projects` | D·ª± √°n x√¢y d·ª±ng |
| `project_users` | Ph√¢n quy·ªÅn user theo d·ª± √°n |
| `materials` | Danh m·ª•c h√†ng h√≥a |
| `material_density_history` | L·ªãch s·ª≠ thay ƒë·ªïi t·ª∑ tr·ªçng |
| `warehouses` | Danh s√°ch kho |
| `vehicles` | Danh s√°ch xe v·∫≠n chuy·ªÉn |
| `purchase_receipts` | Phi·∫øu nh·∫≠p mua |
| `export_receipts` | Phi·∫øu xu·∫•t b√°n |
| `transport_logs` | Chi ti·∫øt chuy·∫øn xe |
| `inventory_snapshots` | Ch·ª•p t·ªìn kho ƒë·ªãnh k·ª≥ |

### Logic quy ƒë·ªïi ƒë∆°n v·ªã

```
Nh·∫≠p mua:  m¬≥ = T·∫•n √∑ T·ª∑ tr·ªçng
Xu·∫•t b√°n:  T·∫•n = m¬≥ √ó T·ª∑ tr·ªçng

V√≠ d·ª•:
- Nh·∫≠p 15 T·∫•n ƒë√° h·ªôc (t·ª∑ tr·ªçng 1.5) ‚Üí 15 √∑ 1.5 = 10 m¬≥
- Xu·∫•t 10 m¬≥ ƒë√° h·ªôc (t·ª∑ tr·ªçng 1.5) ‚Üí 10 √ó 1.5 = 15 T·∫•n
```

---

## üîê API Endpoints

### Authentication
| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| POST | `/api/auth/login` | ƒêƒÉng nh·∫≠p |
| POST | `/api/auth/register` | ƒêƒÉng k√Ω |
| POST | `/api/auth/refresh` | L√†m m·ªõi token |
| GET | `/api/auth/me` | Th√¥ng tin user hi·ªán t·∫°i |
| POST | `/api/auth/logout` | ƒêƒÉng xu·∫•t |

### Materials
| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| GET | `/api/materials` | Danh s√°ch h√†ng h√≥a |
| GET | `/api/materials/:id` | Chi ti·∫øt h√†ng h√≥a |
| POST | `/api/materials` | Th√™m h√†ng h√≥a |
| PUT | `/api/materials/:id` | C·∫≠p nh·∫≠t h√†ng h√≥a |
| DELETE | `/api/materials/:id` | X√≥a h√†ng h√≥a (soft) |
| GET | `/api/materials/:id/density-history` | L·ªãch s·ª≠ t·ª∑ tr·ªçng |

### Purchases (Nh·∫≠p mua)
| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| GET | `/api/purchases` | Danh s√°ch phi·∫øu nh·∫≠p |
| GET | `/api/purchases/:id` | Chi ti·∫øt phi·∫øu nh·∫≠p |
| POST | `/api/purchases` | T·∫°o phi·∫øu nh·∫≠p |
| PUT | `/api/purchases/:id` | C·∫≠p nh·∫≠t phi·∫øu nh·∫≠p |
| DELETE | `/api/purchases/:id` | X√≥a phi·∫øu nh·∫≠p (soft) |
| GET | `/api/purchases/stats/today` | Th·ªëng k√™ h√¥m nay |

### Reports
| Method | Endpoint | M√¥ t·∫£ |
|--------|----------|-------|
| GET | `/api/reports/dashboard` | T·ªïng quan dashboard |
| GET | `/api/reports/inventory` | B√°o c√°o t·ªìn kho |
| GET | `/api/reports/transport` | B√°o c√°o v·∫≠n t·∫£i |
| GET | `/api/reports/project-profit` | B√°o c√°o l√£i/l·ªó d·ª± √°n |

---

## üõ°Ô∏è Ph√¢n quy·ªÅn (RBAC)

| Role | Quy·ªÅn truy c·∫≠p |
|------|----------------|
| `admin` | To√†n quy·ªÅn (`*`) |
| `accountant` | ƒê·ªçc t·∫•t c·∫£, vi·∫øt b√°o c√°o |
| `warehouse` | Qu·∫£n l√Ω kho, nh·∫≠p/xu·∫•t |
| `logistics` | Qu·∫£n l√Ω xe, v·∫≠n chuy·ªÉn |
| `field_worker` | Nh·∫≠p phi·∫øu mua t·∫°i hi·ªán tr∆∞·ªùng |

### Ph√¢n quy·ªÅn theo D·ª± √°n
- M·ªói user ƒë∆∞·ª£c g√°n v√†o c√°c d·ª± √°n c·ª• th·ªÉ
- User ch·ªâ th·∫•y d·ªØ li·ªáu c·ªßa d·ª± √°n ƒë∆∞·ª£c c·∫•p
- Admin th·∫•y t·∫•t c·∫£ d·ª± √°n

---

## üé® UI/UX Features

- **Mobile-first responsive design**
- **Real-time unit conversion** (T·∫•n ‚Üî m¬≥)
- **Dashboard v·ªõi th·ªëng k√™ tr·ª±c quan**
- **Table v·ªõi filter, search, pagination**
- **Toast notifications cho feedback**
- **Modal forms cho CRUD operations**
- **Dark-ready color palette**

---

## üö¢ Deployment

### Frontend (Vercel)

```bash
cd ebh-frontend
npm run build
# Deploy to Vercel
npx vercel --prod
```

### Backend (Railway/Render)

```bash
cd server
npm run build
# Deploy to Railway or Render
```

### Environment Variables (Production)

```env
# Frontend (.env)
VITE_API_URL=https://your-backend-url.com/api

# Backend (.env)
NODE_ENV=production
PORT=5000
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
JWT_SECRET=very-long-random-string
JWT_REFRESH_SECRET=another-long-random-string
CORS_ORIGIN=https://your-frontend-url.com
```

---

## üìù Workflow Nghi·ªáp v·ª•

### B∆∞·ªõc 1: Kh·ªüi t·∫°o (Admin)
1. Khai b√°o H√†ng h√≥a + T·ª∑ tr·ªçng
2. Khai b√°o Kho
3. Khai b√°o ƒê·ªôi xe
4. T·∫°o D·ª± √°n
5. Ph√¢n quy·ªÅn User ‚Üí D·ª± √°n

### B∆∞·ªõc 2: Nh·∫≠p mua (NV Hi·ªán tr∆∞·ªùng)
1. ƒêƒÉng nh·∫≠p mobile
2. Ch·ªçn Kho, H√†ng h√≥a, D·ª± √°n
3. Nh·∫≠p s·ªë T·∫•n
4. H·ªá th·ªëng t·ª± ƒë·ªông t√≠nh m¬≥
5. L∆∞u phi·∫øu ‚Üí C·∫≠p nh·∫≠t t·ªìn kho

### B∆∞·ªõc 3: Xu·∫•t b√°n (Kho/Logistics)
1. Ch·ªçn D·ª± √°n, H√†ng h√≥a, Xe
2. Nh·∫≠p s·ªë m¬≥ xu·∫•t
3. H·ªá th·ªëng t√≠nh T·∫•n, tr·ª´ t·ªìn
4. Ghi log chuy·∫øn xe

### B∆∞·ªõc 4: B√°o c√°o (S·∫øp/K·∫ø to√°n)
1. Xem t·ªìn kho theo T·∫•n & m¬≥
2. Xem b√°o c√°o v·∫≠n t·∫£i
3. Xem l√£i/l·ªó theo d·ª± √°n

---

## üìÑ License

MIT License

---

## ü§ù Li√™n h·ªá

Developed for EBH Construction & Logistics
